#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è GitHub Pages

echo "üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ GitHub Pages –ª–æ–∫–∞–ª—å–Ω–æ..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
if [ ! -f "Makefile" ]; then
    echo "‚ùå –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞"
    exit 1
fi

# –°–æ–±–∏—Ä–∞–µ–º production –≤–µ—Ä—Å–∏—é
echo "üì¶ –°–±–æ—Ä–∫–∞ production –≤–µ—Ä—Å–∏–∏..."
make prod

# –ö–æ–ø–∏—Ä—É–µ–º –≤ docs
echo "üìÅ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ docs..."
rm -rf docs/*
cp -r build/production/JsonViewer/* docs/
touch docs/.nojekyll

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤..."
if [ ! -f "docs/index.html" ]; then
    echo "‚ùå index.html –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

if [ ! -f "docs/app.js" ]; then
    echo "‚ùå app.js –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

if [ ! -f "docs/.nojekyll" ]; then
    echo "‚ùå .nojekyll –Ω–µ –Ω–∞–π–¥–µ–Ω"
    exit 1
fi

echo "‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ"
echo "üìä –†–∞–∑–º–µ—Ä docs: $(du -sh docs/ | cut -f1)"

# –ó–∞–ø—É—Å–∫–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
echo "üåê –ó–∞–ø—É—Å–∫ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞..."
echo "üì± –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000 –≤ –±—Ä–∞—É–∑–µ—Ä–µ"
echo "‚èπÔ∏è  –ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏"

cd docs && python3 -m http.server 8000 