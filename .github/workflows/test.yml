name: Test Build

on:
  pull_request:
    branches: [ main, master ]

jobs:
  test-build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3
      
    - name: Build Docker image
      run: make build
      
    - name: Test ExtJS application build
      run: make prod
      
    - name: Verify build output
      run: |
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Å–±–æ—Ä–∫–∞ —Å–æ–∑–¥–∞–ª–∞—Å—å
        if [ ! -d "build/production/JsonViewer" ]; then
          echo "‚ùå Production build not found"
          exit 1
        fi
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
        if [ ! -f "build/production/JsonViewer/index.html" ]; then
          echo "‚ùå index.html not found"
          exit 1
        fi
        
        if [ ! -f "build/production/JsonViewer/app.js" ]; then
          echo "‚ùå app.js not found"
          exit 1
        fi
        
        echo "‚úÖ Build verification passed"
        echo "üìÅ Build size: $(du -sh build/production/JsonViewer/ | cut -f1)" 